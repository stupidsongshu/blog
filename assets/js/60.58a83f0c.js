(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{376:function(s,a,e){"use strict";e.r(a);var t=e(18),r=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"node-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-js"}},[s._v("#")]),s._v(" Node.js")]),s._v(" "),a("h3",{attrs:{id:"node-js上线部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-js上线部署"}},[s._v("#")]),s._v(" node.js上线部署")]),s._v(" "),a("p",[s._v("ssh 用户名@地址（免密登陆）")]),s._v(" "),a("p",[s._v("scp course-map.json root@IP地址:/路径")]),s._v(" "),a("p",[s._v("scp -r advance / root@101.200.185.250:/opt/node-publish/www/static")]),s._v(" "),a("p",[s._v("npm install --production 只管上线环境")]),s._v(" "),a("p",[s._v("Unix domain Socket 走IPC")]),s._v(" "),a("h3",{attrs:{id:"服务器集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务器集群"}},[s._v("#")]),s._v(" 服务器集群")]),s._v(" "),a("ul",[a("li",[s._v("Nginx -> PM2 -> Varnish -> Java -> DB(read/wirte) -> BACK")]),s._v(" "),a("li",[s._v("PM 2 -> CDN")]),s._v(" "),a("li",[s._v("Nagios监测")]),s._v(" "),a("li",[s._v("Keepalived heartbeat心跳检测: Varnish -> Java")])]),s._v(" "),a("h3",{attrs:{id:"经典代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#经典代码"}},[s._v("#")]),s._v(" 经典代码：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("职责链模式：router.get(/^(\\d+)_(\\d+)/, cModel.A, cModel.B, cModel.C)")])]),s._v(" "),a("li",[a("p",[s._v("var shaObj = new jsSHA(string, 'TEXT'); var hash = shaObj.getHash('SHA-1', 'HEX');")])]),s._v(" "),a("li",[a("p",[s._v("var forPound = req.headers['x-forwarded-for-pound'];")])]),s._v(" "),a("li",[a("p",[s._v("回调：callback(new Error('Fail to parse http response to json, url:' + reqOptions.url), res.body);")])]),s._v(" "),a("li",[a("p",[s._v("中间件：require('./middleware')(app);")])])]),s._v(" "),a("h3",{attrs:{id:"源码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#源码"}},[s._v("#")]),s._v(" 源码")]),s._v(" "),a("ul",[a("li",[s._v("git clone git@github.com:nodejs/node.git")]),s._v(" "),a("li",[s._v("cd ./node")]),s._v(" "),a("li",[s._v("./configure && make")]),s._v(" "),a("li",[s._v("make install")]),s._v(" "),a("li",[s._v("make test")])]),s._v(" "),a("h3",{attrs:{id:"node-js启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-js启动"}},[s._v("#")]),s._v(" node.js启动:")]),s._v(" "),a("ul",[a("li",[s._v("src/node.h")]),s._v(" "),a("li",[s._v("src/node.cc Start()")]),s._v(" "),a("li",[s._v("lib/internal/bootstrap_node.js")])]),s._v(" "),a("h3",{attrs:{id:"node-js测试文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-js测试文件"}},[s._v("#")]),s._v(" node.js测试文件")]),s._v(" "),a("ul",[a("li",[s._v("test/parallel/test-*.js")])]),s._v(" "),a("h3",{attrs:{id:"pr规范"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pr规范"}},[s._v("#")]),s._v(" pr规范：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("branch name: fix/gh-{number: issue id}")])]),s._v(" "),a("li",[a("p",[s._v('commit message: "module name: description"')])]),s._v(" "),a("li",[a("p",[s._v("开启debug模式 "),a("code",[s._v("node --debug app.js")])])]),s._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://www.npmjs.com/package/node-inspector",target:"_blank",rel:"noopener noreferrer"}},[s._v("node-inspector"),a("OutboundLink")],1)])])]),s._v(" "),a("h2",{attrs:{id:"pm2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pm2"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://pm2.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("PM2"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进程管理")]),s._v("\npm2 start server.js "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" my-server\npm2 list "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pm2 ls")]),s._v("\npm2 restart my-server\npm2 stop my-server\npm2 delete my-server\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 负载均衡")]),s._v("\npm2 start server.js "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\npm2 start server.js "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" max\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志管理")]),s._v("\npm2 logs\npm2 logs my-server\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 性能监控")]),s._v("\npm2 monit\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])])])}),[],!1,null,null,null);a.default=r.exports}}]);