(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{214:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"工程化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#工程化","aria-hidden":"true"}},[s._v("#")]),s._v(" 工程化")]),s._v(" "),a("h2",{attrs:{id:"免密登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#免密登录","aria-hidden":"true"}},[s._v("#")]),s._v(" 免密登录")]),s._v(" "),a("ul",[a("li",[a("ol",[a("li",[a("a",{attrs:{href:"https://help.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh",target:"_blank",rel:"noopener noreferrer"}},[s._v("生成秘钥对"),a("OutboundLink")],1)])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -t 指定生成算法")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -b 生成长度（默认为2048）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -C 在生成的key中添加标识")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -f 指定生成的文件名（默认为id_rsa）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意：引号不能用单引号，必须是双引号")]),s._v("\nssh-keygen -t rsa -b "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" -C "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"your_email@example.com"')]),s._v(" -f 指定文件名\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("ul",[a("li",[s._v("然后直接按连续两次回车")])])]),s._v(" "),a("li",[a("ol",{attrs:{start:"2"}},[a("li",[s._v("上传配置公钥")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 上传公钥到服务器对应账号的~路径下的.ssh/中")]),s._v("\nssh-copy-id -i 公钥文件名 用户名@服务器ip或域名\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[s._v("配置公钥文件访问权限为"),a("strong",[s._v("600")])])])]),s._v(" "),a("li",[a("ol",{attrs:{start:"3"}},[a("li",[s._v("配置本地私钥")])]),s._v(" "),a("ul",[a("li",[s._v("把第一步生成的私钥移动到~下的.ssh/目录中")]),s._v(" "),a("li",[s._v("配置私钥文件访问权限为"),a("strong",[s._v("600")])])])]),s._v(" "),a("li",[a("ol",{attrs:{start:"4"}},[a("li",[s._v("免密登录功能的本地配置文件")])]),s._v(" "),a("ul",[a("li",[s._v("修改~路径下的.ssh目录中的config文件")]),s._v(" "),a("li",[s._v("配置config文件的访问权限为"),a("strong",[s._v("644")])])])])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n * @description 免密登录config模板\n*/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 多主机配置")]),s._v("\nHost gateway"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("produce\nHostName "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("或绑定的域名\nPort "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("\nHost node"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("produce\nHostName "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("或绑定的域名\nPort "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("\nHost java"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("produce\nHostName "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("或绑定的域名\nPort "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("\n\nHost "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("produce\nUser root\nIdentityFile "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ssh"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("produce_key_rsa\nProtocol "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nCompression yes\nServerAliveInterval "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\nServerAliveCountMax "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\nLogLevel "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INFO")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 单主机配置")]),s._v("\nHost aliasName\nUser root\nHostName "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("IP")]),s._v("或绑定的域名\nIdentityFile "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ssh"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("test_rsa\nProtocol "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nCompression yes\nServerAliveInterval "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\nServerAliveCountMax "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\nLogLevel "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INFO")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h2",{attrs:{id:"ci-cd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ci-cd","aria-hidden":"true"}},[s._v("#")]),s._v(" CI/CD")]),s._v(" "),a("ul",[a("li",[s._v("CI/CD (Continuous Integration/Continuous Delivery)")])]),s._v(" "),a("h3",{attrs:{id:"jenkins"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins","aria-hidden":"true"}},[s._v("#")]),s._v(" jenkins")]),s._v(" "),a("p",[a("a",{attrs:{href:"http://111.229.81.101:8080/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://111.229.81.101:8080/"),a("OutboundLink")],1),s._v(" (root root | jenkins hao123456)")]),s._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://wiki.jenkins.io/display/JENKINS/Installing+Jenkins+on+Red+Hat+distributions",target:"_blank",rel:"noopener noreferrer"}},[s._v("wiki"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://jenkins.io/zh/doc/book/installing/#%E7%B3%BB%E7%BB%9F%E8%A6%81%E6%B1%82",target:"_blank",rel:"noopener noreferrer"}},[s._v("系统要求 Java 8"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("oracle官方下载地址"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("p",[s._v("openjdk")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("yum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" java-1.8.0-openjdk\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("java版本的升级或降级")]),s._v(" "),a("ul",[a("li",[s._v("检查已安装的包(rpm -qa | grep java)")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -qa "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" java\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" javapackages-tools-3.4.1-11.el7.noarch\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" tzdata-java-2019c-1.el7.noarch\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" python-javapackages-3.4.1-11.el7.noarch\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" java-1.8.0-openjdk-1.8.0.232.b09-0.el7_7.x86_64\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" java-1.8.0-openjdk-headless-1.8.0.232.b09-0.el7_7.x86_64\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("ul",[a("li",[s._v("删除包(rpm -e --nodeps 包名)")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -e --nodeps java-1.8.0-openjdk-1.8.0.232.b09-0.el7_7.x86_64\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -e --nodeps java-1.8.0-openjdk-headless-1.8.0.232.b09-0.el7_7.x86_64\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[s._v("重新安装")])])]),s._v(" "),a("li",[a("p",[s._v("登录默认用户名：admin；初始密码：cat /var/lib/jenkins/secrets/initialAdminPassword")])])]),s._v(" "),a("h4",{attrs:{id:"git配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#git配置","aria-hidden":"true"}},[s._v("#")]),s._v(" git配置")]),s._v(" "),a("div",{staticClass:"danger custom-block"},[a("h3",{attrs:{id:"错误提示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#错误提示","aria-hidden":"true"}},[s._v("#")]),s._v(" 错误提示")]),s._v(" "),a("p",[s._v('无法连接仓库：Command "git ls-remote -h git@github.com:stupidsongshu/book-system.git HEAD" returned status code 128:\nstdout:\nstderr: Host key verification failed.\nfatal: Could not read from remote repository.')]),s._v(" "),a("p",[s._v("Please make sure you have the correct access rights\nand the repository exists.")])]),s._v(" "),a("ul",[a("li",[s._v("公钥配置\n"),a("ul",[a("li",[s._v("一、"),a("strong",[s._v("需要使用jenkins用户身份生成密钥")]),s._v("，如果不是的话有以下两种解决方法\n"),a("ul",[a("li",[a("ol",[a("li",[s._v("直接改变用户身份")])])])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" ~/.ssh\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" jenkins jenkins_rsa.pub\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" jenkins jenkins_rsa\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[a("ol",{attrs:{start:"2"}},[a("li",[s._v("切换到jenkins用户后重新生成")])])])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" jenkins\nssh-keygen -t rsa -C "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"邮箱标识"')]),s._v(" -f ~/.ssh/jenkins_rsa\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# jenkins需要在指定的服务器上安装私钥和公钥,而且公钥的名称务必用 authorized_keys 文件名")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" jenkins_rsa.pub "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" authorized_keys\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])]),s._v(" "),a("li",[s._v("二、将公钥添加到 github -> Settings -> SSH")])])]),s._v(" "),a("li",[s._v("私钥配置\n"),a("ul",[a("li",[s._v("jenkins需要安装 Publish over SSH 插件")]),s._v(" "),a("li",[s._v("将私钥添加到jenkins的配置中（Manage Jenkins -> Configure System -> Publish over SSH）")])])])]),s._v(" "),a("h4",{attrs:{id:"su-jenkins-无法切换到jenkins用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#su-jenkins-无法切换到jenkins用户","aria-hidden":"true"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://blog.csdn.net/u013066244/article/details/52694772",target:"_blank",rel:"noopener noreferrer"}},[s._v("su jenkins 无法切换到jenkins用户"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"sonarqube"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sonarqube","aria-hidden":"true"}},[s._v("#")]),s._v(" SonarQube")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.sonarqube.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://docs.sonarqube.org/latest/",target:"_blank",rel:"noopener noreferrer"}},[s._v("docs"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://blog.csdn.net/weixin_42018258/article/details/102806089",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考链接"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://notebook.yasithab.com/centos/centos-7-install-sonarqube",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考链接"),a("OutboundLink")],1)])]),s._v(" "),a("h3",{attrs:{id:"docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker","aria-hidden":"true"}},[s._v("#")]),s._v(" docker")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("docker\ndocker version\ndocker info\n\ndocker images      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看本地镜像列表")]),s._v("\ndocker search      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从Docker Hub查找镜像")]),s._v("\ndocker pull        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从镜像仓库中拉取或者更新指定镜像")]),s._v("\ndocker build       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 Dockerfile 创建镜像")]),s._v("\ndocker run         "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建一个新的容器并运行一个命令")]),s._v("\ndocker rmi 镜像名   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除一个镜像")]),s._v("\n\ndocker "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看启动的容器，加参数 -a 查看所有的容器")]),s._v("\ndocker start 容器名 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动容器")]),s._v("\ndocker stop  容器名 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 停止容器")]),s._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v("    容器名 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除容器")]),s._v("\n\ndocker network "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网络列表")]),s._v("\n\ndocker inspect 容器名/镜像名/网络名称 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取容器/镜像/网络的元数据")]),s._v("\n\ndocker logs 容器名/容器id "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看容器日志")]),s._v("\ndocker logs -f 容器名/容器id "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看容器日志")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/docker/daemon.json "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看镜像源")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改为国内镜像源 https://juejin.im/post/5cd2cf01f265da0374189441")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://qujwc3yg.mirror.aliyuncs.com # 阿里云 https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# http://f1361db2.m.daocloud.io        # DaoCloud")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://docker.mirrors.ustc.edu.cn   # 中科大")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://hub-mirror.c.163.com         # 网易")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://registry.docker-cn.com       # docker 官方中国区")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /etc/docker\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/docker/daemon.json "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<-")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'EOF\'\n{\n  "registry-mirrors": [\n    "https://qujwc3yg.mirror.aliyuncs.com",\n    "http://f1361db2.m.daocloud.io",\n    "https://docker.mirrors.ustc.edu.cn",\n    "https://hub-mirror.c.163.com",\n    "https://registry.docker-cn.com"\n  ]\n}\nEOF')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl daemon-reload\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart docker\n\ndocker run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9000")]),s._v(":3000 docker_demo "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动镜像：-d 后台执⾏；-p 9000:3000 指定宿主机的9000端⼝映射到docker容器内的3000端⼝；docker_demo 为镜像名称")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br")])]),a("h4",{attrs:{id:"docker-练习"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-练习","aria-hidden":"true"}},[s._v("#")]),s._v(" docker 练习")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Open a command-line terminal and test that your installation works by running the simple Docker image, hello-world:")]),s._v("\ndocker run hello-world\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Start a Dockerized web server. Like the hello-world image above, if the image is not found locally, Docker pulls it from Docker Hub.")]),s._v("\ndocker run --detach --publish"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":80 --name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("webserver nginx\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 项目：getting-started")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/docker/getting-started.git\ndocker build -t docker101tutorial "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\ndocker run -dp "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":80 docker/getting-started\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 项目：doodle")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. This repository contains everything you need to create your first container.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/docker/doodle.git\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. Now let's build and tag a Docker image.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# A Docker image is a private filesystem, just for your container. It provides all the files and code your container will need. Running the docker build command creates a Docker image using the Dockerfile. This built image is in your machine's local Docker image registry.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" doodle/cheers2019 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" docker build -t summerycicada/cheers2019 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3. Now let's run your first container.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Running a container launches your software with private resources, securely isolated from the rest of your machine.")]),s._v("\ndocker run -it --rm summerycicada/cheers2019\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4. Share your image on Docker Hub ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Once you're ready to share your container with the world, push the image that describes it to Docker Hub.")]),s._v("\ndocker login "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" docker push summerycicada/cheers2019\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("h3",{attrs:{id:"drone"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#drone","aria-hidden":"true"}},[s._v("#")]),s._v(" drone")]),s._v(" "),a("p",[a("a",{attrs:{href:"http://111.229.81.101/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://111.229.81.101/"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"warning custom-block"},[a("p",[a("a",{attrs:{href:"https://drone.io",target:"_blank",rel:"noopener noreferrer"}},[s._v("drone"),a("OutboundLink")],1),s._v("官网文档资料不全，许多命令及api需要看"),a("a",{attrs:{href:"https://github.com/drone/drone",target:"_blank",rel:"noopener noreferrer"}},[s._v("源码"),a("OutboundLink")],1)])]),s._v(" "),a("h4",{attrs:{id:"基于docker及github安装drone"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基于docker及github安装drone","aria-hidden":"true"}},[s._v("#")]),s._v(" 基于docker及github安装drone")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://yq.aliyun.com/articles/110806",target:"_blank",rel:"noopener noreferrer"}},[s._v("aliyun Docker CE 镜像源站"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装必要的系统工具")]),s._v("\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y yum-utils device-mapper-persistent-data lvm2\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加软件源")]),s._v("\nyum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更新yum缓存")]),s._v("\nyum makecache fast\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装docker")]),s._v("\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y docker-ce\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置国内镜像源")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://github.com/Azure/container-service-for-azure-china/blob/master/aks/README.md#22-container-registry-proxy")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl -sSL http://oyh1cogl9.bkt.clouddn.com/setmirror.sh | sh -s <镜像加速地址>")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -sSL http://oyh1cogl9.bkt.clouddn.com/setmirror.sh "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" -s http://dockerhub.azk8s.cn "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Azure")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动Docker")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl start docker\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装docker compose")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# curl -L "https://github.com/docker/compose/releases/download/1.24.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 给docker compose可执行权限")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chmod +x /usr/local/bin/docker-compose")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# github 配置认证信息: Settings - Developer settings - OAuth Apps")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 drone server")]),s._v("\ndocker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --volume"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/var/lib/drone:/data "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --env"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DRONE_AGENTS_ENABLED"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --env"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DRONE_GITHUB_SERVER"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://github.com "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --env"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DRONE_GITHUB_CLIENT_ID"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("355e068718b368c85388 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --env"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DRONE_GITHUB_CLIENT_SECRET"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("7244892c28295ae9e9b7cb83913aa2ac8d2d5af7 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --env"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DRONE_RPC_SECRET"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("9a3e564e1d6d8649d4111f14332c0292 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --env"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DRONE_SERVER_HOST"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("111.229")]),s._v(".81.101 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --env"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DRONE_SERVER_PROTO"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --env"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DRONE_YAML_ENDPOINT"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://111.229.81.101:3001/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --env"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("DRONE_YAML_SECRET"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --publish"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":80 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --publish"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(":443 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --restart"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --detach"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("drone "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  drone/drone:1\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 drone agent")]),s._v("\ndocker run -d "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -v /var/run/docker.sock:/var/run/docker.sock "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DRONE_RPC_PROTO")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DRONE_RPC_HOST")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("111.229")]),s._v(".81.101 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DRONE_RPC_SECRET")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("9a3e564e1d6d8649d4111f14332c0292 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DRONE_RUNNER_CAPACITY")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DRONE_RUNNER_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("node "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v(":3000 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --restart always "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --name runner "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  drone/drone-runner-docker:1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br")])]),a("h4",{attrs:{id:"安装drone-cli"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装drone-cli","aria-hidden":"true"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://docs.drone.io/cli/install",target:"_blank",rel:"noopener noreferrer"}},[s._v("安装drone CLI"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 drone cli")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -L https://github.com/drone/drone-cli/releases/latest/download/drone_linux_amd64.tar.gz "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" zx\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -t /usr/local/bin drone\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看版本")]),s._v("\ndrone --version\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# authorization token 在 Drone account settings.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DRONE_SERVER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://drone.mycompany.com\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DRONE_TOKEN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看信息")]),s._v("\ndrone info\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看仓库")]),s._v("\ndrone repo "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# drone build promote -h")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# drone build promote [command options] <repo/name> <build> <environment>")]),s._v("\ndrone build promote stupidsongshu/CICD-drone "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" staging\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看秘钥")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# drone secret ls -h")]),s._v("\ndrone secret "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" --repository stupidsongshu/CICD-drone\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成秘钥")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# drone secret add --repository <MY_REPO> --name deploy_key --value @/home/<USERNAME>/.ssh/id_rsa")]),s._v("\ndrone secret "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" --repository stupidsongshu/CICD-drone --name deploy_key --data @/root/.ssh/id_rsa\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除秘钥")]),s._v("\ndrone secret "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" --repository stupidsongshu/CICD-drone --name deploy_key\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("h4",{attrs:{id:"drone-yml-pipeline-范例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#drone-yml-pipeline-范例","aria-hidden":"true"}},[s._v("#")]),s._v(" .drone.yml pipeline 范例")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pipeline\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" docker\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("steps")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" install\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("alpine\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("commands")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" npm i "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("registry=https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//registry.npm.taobao.org\n\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("alpine\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("commands")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" npm run test\n\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" build\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("alpine\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("commands")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" npm run build\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ls "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("al\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# script:")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - echo $USER")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - cd ~/.ssh")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - ls -al")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - rm -rf /root/docs")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - mkdir /root/docs")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - cp -r .vuepress/dist/* /root/docs")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同一台机器")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - name: deploy")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   image: appleboy/drone-scp")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   settings:")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     host:")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#       - 111.229.81.101")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     username: root")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     password: !1qaz@2WSX")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     password:")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#       from_secret: ssh_key")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     port: 22")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     source:")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#       - .vuepress/dist/*")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     target: /root/docs")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     rm: true")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# secrets: [ deploy_key ]")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# key_path: /root/.ssh/ssh_key")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# secrets:")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   - source: deploy_key")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     target: ssh_key")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rsync production\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" drillster/drone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rsync\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("RSYNC_KEY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("from_secret")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rsync_key\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("settings")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 111.229.81.101\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("source")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" .vuepress/dist/*\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("target")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /root/docs\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("secrets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" rsync_key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("when")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("target")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" production\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("event")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" promote\n\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rsync staging\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" drillster/drone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rsync\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("RSYNC_KEY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("from_secret")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rsync_key\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("settings")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" root\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 111.229.81.101\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("source")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" .vuepress/dist/*\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("target")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /root/docs\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("secrets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" rsync_key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("when")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("target")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" staging\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("event")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" promote\n\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" notify\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" curlimages/curl\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("commands")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[s._v('\n        curl \'https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=dbb3fa53-29f8-4394-bfa1-ecce009e8cbb\' -H \'Content-Type: application/json\' -d \'{"msgtype": "text", "text": {"content": "ok"}}\'')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("when")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" failure\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" success\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br")])]),a("h4",{attrs:{id:"使用jsonnet解决yaml中多环境配置复用问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用jsonnet解决yaml中多环境配置复用问题","aria-hidden":"true"}},[s._v("#")]),s._v(" 使用jsonnet解决yaml中多环境配置复用问题")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://jsonnet.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("jsonnet"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("drone jsonnet --stream --stdout\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"travis-ci"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#travis-ci","aria-hidden":"true"}},[s._v("#")]),s._v(" Travis CI")]),s._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://travis-ci.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Travis CI"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://travis-ci.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Travis CI"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://docs.travis-ci.com/user/tutorial/",target:"_blank",rel:"noopener noreferrer"}},[s._v("docs"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("p",[s._v("在 github Marketplace 安装 travis")])]),s._v(" "),a("li",[a("p",[s._v("新增 .travis.yml 配置文件")])])]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# .travis.yml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("language")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node_js\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("sudo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cache")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("directories")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" node_modules\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("node_js")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" stable\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("install")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" npm install "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("D\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" cd ./test/smoke/template\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" npm install "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("D\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" cd ../../../\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scripts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" npm run test\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" npm run build\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h2",{attrs:{id:"ioc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ioc","aria-hidden":"true"}},[s._v("#")]),s._v(" IOC")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/jeffijoe/awilix",target:"_blank",rel:"noopener noreferrer"}},[s._v("awilix"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/inversify/InversifyJS",target:"_blank",rel:"noopener noreferrer"}},[s._v("inversify"),a("OutboundLink")],1)])]),s._v(" "),a("h2",{attrs:{id:"测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试","aria-hidden":"true"}},[s._v("#")]),s._v(" 测试")]),s._v(" "),a("h3",{attrs:{id:"e2e"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#e2e","aria-hidden":"true"}},[s._v("#")]),s._v(" e2e")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/nightwatchjs/nightwatch",target:"_blank",rel:"noopener noreferrer"}},[s._v("nightwatch"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/g-plane/rize",target:"_blank",rel:"noopener noreferrer"}},[s._v("rize"),a("OutboundLink")],1)])]),s._v(" "),a("h2",{attrs:{id:"基于docker、git、node-js的ci-cd、devops"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基于docker、git、node-js的ci-cd、devops","aria-hidden":"true"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://mp.weixin.qq.com/s/00xwOLL9HTN210bkdy-KNw",target:"_blank",rel:"noopener noreferrer"}},[s._v("基于Docker、Git、Node.js的CI/CD、DevOps"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("a",{attrs:{href:"https://gogs.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("gogs"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"一、基于docker-gogs搭建一个git服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、基于docker-gogs搭建一个git服务","aria-hidden":"true"}},[s._v("#")]),s._v(" 一、基于Docker gogs搭建一个git服务")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拉取gogs镜像创建git服务")]),s._v("\ndocker pull gogs/gogs\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建gogs存储目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /var/gogs\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所有者为当前用户")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${"),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("}")]),s._v(" /var/gogs\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建docker网络便于容器进行通信")]),s._v("\ndocker network create cicd_net\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动gogs容器")]),s._v("\ndocker run -d --name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("gogs --network cicd_net -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),s._v(":3000 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9999")]),s._v(":22 -v /var/gogs:/data gogs/gogs\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("访问 "),a("code",[s._v("http://localhost:8888/")]),s._v("，首次访问需进行配置安装，注册登录，添加SSH密钥")]),s._v(" "),a("h3",{attrs:{id:"二、编写web服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、编写web服务","aria-hidden":"true"}},[s._v("#")]),s._v(" 二、编写web服务")]),s._v(" "),a("p",[s._v("创建一个git仓库（仓库名为 "),a("strong",[s._v("cicd-web")]),s._v("），clone到本地后，编写一个node.js web服务：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// index.js")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" http "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PORT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v("\n\nhttp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("createServer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Hello World!'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("listen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PORT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("Web Server is running on port ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PORT")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("创建Dockerfile文件，生成web服务docker镜像：")]),s._v(" "),a("div",{staticClass:"language-Dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('FROM node:14.4.0-alpine3.11\n\nWORKDIR /usr/src/app\n\nCOPY package*.json ./\n\nRUN npm install --only=production\n\nCOPY . .\n\nCMD ["node","index.js"]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("手动构建镜像并运行容器，访问node.js web服务 "),a("code",[s._v("http://localhost:3000/")]),s._v("，可以看到页面输出 "),a("code",[s._v("Hello World!")])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("docker build -t cicd-web-image "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\ndocker run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v(":3000 --name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cicd-web-container cicd-web-image\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"三、编写deploy服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、编写deploy服务","aria-hidden":"true"}},[s._v("#")]),s._v(" 三、编写deploy服务")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" deploy.sh\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x deploy.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#! /bin/sh")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("projectName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cicd-web'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("userName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cicada'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dockerImageName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cicd-web-image'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dockerContainerName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cicd-web-container'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" -d "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"www/'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${projectName}")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'======git clone======'")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" www\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone http://gogs:3000/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${userName}")]),s._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${projectName}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${projectName}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'======git pull======'")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" www/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${projectName}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" pull\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删掉旧的容器和镜像")]),s._v("\ndocker stop "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${dockerContainerName}")]),s._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${dockerContainerName}")]),s._v("\ndocker rmi -f "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${dockerImageName}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果deploy部署服务与生产环境不在同一台docker宿主机，deploy应该publish镜像到远程镜像仓库，然后ssh远程登录执行shell，生产环境执行拉取镜像、构建镜像、运行容器等等")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker publish")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh root@ip")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker pull image")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新构建镜像并运行容器")]),s._v("\ndocker build -t "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${dockerImageName}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\ndocker run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v(":3000 --name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${dockerContainerName}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${dockerImageName}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("p",[s._v("修改node.js")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" http "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" cp "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'child_process'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PORT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4000")]),s._v("\n\nhttp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("createServer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" proc "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("exec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./deploy.sh'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  proc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("stdout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pipe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("stdout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  proc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("stderr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pipe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("stdout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n  res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Deploy Server'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("listen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PORT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("Deploy Server is running on port ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("PORT")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("由于deploy.sh需要git，所以需要添加git镜像，Dockerfile增加"),a("code",[s._v("RUN apk add git")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-Dockerfile line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('FROM node:14.4.0-alpine3.11\n\nRUN apk add git\n\nWORKDIR /usr/src/app\n\nCOPY package*.json ./\n\nRUN npm install --only=production\n\nCOPY . .\n\nCMD ["node","index.js"]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建部署镜像")]),s._v("\ndocker build -t cicd-deploy-container "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 部署容器需要使用宿主机docker命令构建docker镜像")]),s._v("\ndocker run -d --network cicd_net -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4000")]),s._v(":4000 -v /usr/local/bin/docker:/usr/bin/docker -v /var/run/docker.sock:/var/run/docker.sock --user root --name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cicd-deploy-container cicd-deploy-container\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"四、git-hook让deploy自动构建镜像生成web容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、git-hook让deploy自动构建镜像生成web容器","aria-hidden":"true"}},[s._v("#")]),s._v(" 四、git hook让deploy自动构建镜像生成web容器")]),s._v(" "),a("p",[s._v("仓库设置 -> 管理 Web 钩子 ->Discord -> 推送地址填写："),a("code",[s._v("http://cicd-deploy-container:4000")]),s._v(" -> 添加 Web 钩子")])])}),[],!1,null,null,null);t.default=e.exports}}]);