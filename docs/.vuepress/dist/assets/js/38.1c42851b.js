(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{239:function(e,a,r){"use strict";r.r(a);var s=r(0),t=Object(s.a)({},(function(){var e=this,a=e.$createElement,r=e._self._c||a;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"node-js"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#node-js","aria-hidden":"true"}},[e._v("#")]),e._v(" Node.js")]),e._v(" "),r("h3",{attrs:{id:"node-js上线部署"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#node-js上线部署","aria-hidden":"true"}},[e._v("#")]),e._v(" node.js上线部署")]),e._v(" "),r("p",[e._v("ssh 用户名@地址（免密登陆）")]),e._v(" "),r("p",[e._v("scp course-map.json root@IP地址:/路径")]),e._v(" "),r("p",[e._v("scp -r advance / root@101.200.185.250:/opt/node-publish/www/static")]),e._v(" "),r("p",[e._v("npm install --production 只管上线环境")]),e._v(" "),r("p",[e._v("Unix domain Socket 走IPC")]),e._v(" "),r("h3",{attrs:{id:"服务器集群"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#服务器集群","aria-hidden":"true"}},[e._v("#")]),e._v(" 服务器集群")]),e._v(" "),r("ul",[r("li",[e._v("Nginx -> PM2 -> Varnish -> Java -> DB(read/wirte) -> BACK")]),e._v(" "),r("li",[e._v("PM 2 -> CDN")]),e._v(" "),r("li",[e._v("Nagios监测")]),e._v(" "),r("li",[e._v("Keepalived heartbeat心跳检测: Varnish -> Java")])]),e._v(" "),r("h3",{attrs:{id:"经典代码："}},[r("a",{staticClass:"header-anchor",attrs:{href:"#经典代码：","aria-hidden":"true"}},[e._v("#")]),e._v(" 经典代码：")]),e._v(" "),r("ul",[r("li",[r("p",[e._v("职责链模式：router.get(/^(\\d+)_(\\d+)/, cModel.A, cModel.B, cModel.C)")])]),e._v(" "),r("li",[r("p",[e._v("var shaObj = new jsSHA(string, 'TEXT'); var hash = shaObj.getHash('SHA-1', 'HEX');")])]),e._v(" "),r("li",[r("p",[e._v("var forPound = req.headers['x-forwarded-for-pound'];")])]),e._v(" "),r("li",[r("p",[e._v("回调：callback(new Error('Fail to parse http response to json, url:' + reqOptions.url), res.body);")])]),e._v(" "),r("li",[r("p",[e._v("中间件：require('./middleware')(app);")])])]),e._v(" "),r("h3",{attrs:{id:"源码"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#源码","aria-hidden":"true"}},[e._v("#")]),e._v(" 源码")]),e._v(" "),r("ul",[r("li",[e._v("git clone git@github.com:nodejs/node.git")]),e._v(" "),r("li",[e._v("cd ./node")]),e._v(" "),r("li",[e._v("./configure && make")]),e._v(" "),r("li",[e._v("make install")]),e._v(" "),r("li",[e._v("make test")])]),e._v(" "),r("h3",{attrs:{id:"node-js启动"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#node-js启动","aria-hidden":"true"}},[e._v("#")]),e._v(" node.js启动:")]),e._v(" "),r("ul",[r("li",[e._v("src/node.h")]),e._v(" "),r("li",[e._v("src/node.cc Start()")]),e._v(" "),r("li",[e._v("lib/internal/bootstrap_node.js")])]),e._v(" "),r("h3",{attrs:{id:"node-js测试文件"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#node-js测试文件","aria-hidden":"true"}},[e._v("#")]),e._v(" node.js测试文件")]),e._v(" "),r("ul",[r("li",[e._v("test/parallel/test-*.js")])]),e._v(" "),r("h3",{attrs:{id:"pr规范："}},[r("a",{staticClass:"header-anchor",attrs:{href:"#pr规范：","aria-hidden":"true"}},[e._v("#")]),e._v(" pr规范：")]),e._v(" "),r("ul",[r("li",[r("p",[e._v("branch name: fix/gh-{number: issue id}")])]),e._v(" "),r("li",[r("p",[e._v('commit message: "module name: description"')])]),e._v(" "),r("li",[r("p",[e._v("开启debug模式 "),r("code",[e._v("node --debug app.js")])])]),e._v(" "),r("li",[r("p",[r("a",{attrs:{href:"https://www.npmjs.com/package/node-inspector",target:"_blank",rel:"noopener noreferrer"}},[e._v("node-inspector"),r("OutboundLink")],1)])])]),e._v(" "),r("h2",{attrs:{id:"pm2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#pm2","aria-hidden":"true"}},[e._v("#")]),e._v(" "),r("a",{attrs:{href:"https://pm2.io/",target:"_blank",rel:"noopener noreferrer"}},[e._v("PM2"),r("OutboundLink")],1)]),e._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[e._v("pm2 start server.js --name my-server\npm2 list "),r("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# pm2 ls")]),e._v("\npm2 restart my-server\npm2 stop my-server\npm2 monit\npm2 logs my-server\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br"),r("span",{staticClass:"line-number"},[e._v("4")]),r("br"),r("span",{staticClass:"line-number"},[e._v("5")]),r("br"),r("span",{staticClass:"line-number"},[e._v("6")]),r("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);